# zepeto-multiplay-example

![Image of preview](https://github.com/naverz/zepeto-multiplay-example/blob/main/doc/preview.gif)


ê°œë°œ ì„œë²„ë¥¼ ì´ìš©í•œ ë©€í‹°í”Œë ˆì´ ë°ëª¨ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ ì‚¬ì „ì— [ZEPETO ë¡œê·¸ì¸](https://studio.zepeto.me/kr/guides/preparing-for-world-creating)ì„ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.


<br/><br/>

## Overview
[ZEPETO Multiplay](https://studio.zepeto.me/kr/guides/multiplay)ì™€  [Character Controller](https://studio.zepeto.me/kr/guides/character-control) ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ëœ ì˜ˆì œì…ë‹ˆë‹¤. í˜„ì¬ ì ‘ì†ì¤‘ì¸ Roomì˜ ìƒíƒœ (ê° í”Œë ˆì´ì–´ì˜ ìºë¦­í„° ì •ë³´ì™€ ìœ„ì¹˜ë“±)ëŠ” ZEPETO Multiplay íŒ¨í‚¤ì§€ë‚´ì— [Schema file](https://studio.zepeto.me/kr/guides/multiplay-room-state)ì— ì •ì˜ë˜ì–´ ìˆìœ¼ë©° ì´ë¥¼ ê° í´ë¼ì´ì–¸íŠ¸ì— onStateChange ì´ë²¤íŠ¸ ì½œë°±ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. 

- ë‹¤ë¥¸ ê°œë°œ pcì—ì„œ ì ‘ì†í•  ê²½ìš°, IP ì£¼ì†Œë¡œ ì„œë²„ í™˜ê²½ ì„¤ì • í•­ëª©ì„ ì°¸ê³ í•˜ì„¸ìš”.
[Multiplay IP ì£¼ì†Œë¡œ ì ‘ì†í•˜ê¸°](https://studio.zepeto.me/kr/guides/accessing-to-multiplay-ip-addresses)

- ëª¨ë°”ì¼ê¸°ê¸°ë¡œ ì ‘ì†í•  ê²½ìš°, QRì½”ë“œ ìƒì„± í•­ëª©ì„ ì°¸ê³ í•˜ì„¸ìš”. 
 [í…œí”Œë¦¿ìœ¼ë¡œ ì‹œì‘í•˜ê¸°](https://studio.zepeto.me/kr/guides/getting-started-with-templates)

<br/><br/>

## Scenes

- Sample Scene <br/><br/>
![Image of preview](https://github.com/naverz/zepeto-multiplay-example/blob/main/doc/Sample.png)<br/>
https://github.com/naverz/zepeto-multiplay-example/blob/main/Assets/SampleScene.unity<br/><br/><br/><br/>

- Theme Scene <br/><br/>
![Image of preview](https://github.com/naverz/zepeto-multiplay-example/blob/main/doc/Desert.JPG)<br/>
1. ì‚¬ë§‰ í…Œë§ˆ Scene : https://github.com/naverz/zepeto-multiplay-example/blob/main/Assets/Scenes/ThemeScenes/001_Desert.unity<br/><br/><br/><br/>
![Image of preview](https://github.com/naverz/zepeto-multiplay-example/blob/main/doc/Sakura.JPG)<br/>
2. ë²šê½ƒ í…Œë§ˆ Scene : https://github.com/naverz/zepeto-multiplay-example/blob/main/Assets/Scenes/ThemeScenes/002_Sakura.unity<br/><br/><br/><br/>
![Image of preview](https://github.com/naverz/zepeto-multiplay-example/blob/main/doc/ClassRoom.JPG)<br/>
3. êµì‹¤ í…Œë§ˆ Scene : https://github.com/naverz/zepeto-multiplay-example/blob/main/Assets/Scenes/ThemeScenes/003_ClassRoom.unity<br/><br/><br/><br/>
![Image of preview](https://github.com/naverz/zepeto-multiplay-example/blob/main/doc/Camping.JPG)<br/>
4. ìº í•‘ í…Œë§ˆ Scene : https://github.com/naverz/zepeto-multiplay-example/blob/main/Assets/Scenes/ThemeScenes/004_Camping.unity<br/><br/><br/><br/>
![Image of preview](https://github.com/naverz/zepeto-multiplay-example/blob/main/doc/Fall.JPG)<br/>
5. ê°€ì„ í…Œë§ˆ Scene : https://github.com/naverz/zepeto-multiplay-example/blob/main/Assets/Scenes/ThemeScenes/005_Fall.unity<br/><br/><br/><br/>


<br/><br/>

## ë©€í‹°í”Œë ˆì´ ê°€ì´ë“œ ì˜ìƒ
[ 1í¸ : ë©€í‹°í”Œë ˆì´ ì„¤ì •í•˜ê¸° ]
- ë©€í‹°í”Œë ˆì´ ì„œë²„ ìƒì„±ë¶€í„° í´ë¼ì´ì–¸íŠ¸ ìƒì„±ê¹Œì§€, ë©€í‹°í”Œë ˆì´ ì›”ë“œ ê°œë°œì„ ìœ„í•œ í™˜ê²½ ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.
- ì›”ë“œ ì„¸íŒ…, ì„œë²„ ì‹¤í–‰ ë“± ë©€í‹°í”Œë ˆì´ ì›”ë“œ ê°œë°œ ì‹œ ê¼­ í•´ì•¼ í•  ì„¤ì •ë“¤ì„ ì‚´í´ë´…ë‹ˆë‹¤.
- ğŸ¥ ì˜ìƒ ë³´ê¸° : https://youtu.be/S68B1TMa-A8


[ 2í¸ : ì›”ë“œ ë¡œì§ ì‘ì„±í•˜ê¸° 1 ]
- ì„œë²„, í´ë¼ì´ì–¸íŠ¸ ê°„ í†µì‹ ì„ ìœ„í•´ í•„ìš”í•œ Schemaì— ëŒ€í•´ ì•Œì•„ë³´ê³ , Schema Typesì™€ Room Stateë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
- Room Lifecycleì„ í†µí•´ ì„œë²„ì—ì„œ ê¸°ë³¸ì ì¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- ë˜í•œ ì„œë²„ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ Room ìƒì„± ë° ì…ì¥ ì‹œì˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- ë˜í•œ Room Stateë¥¼ í†µí•´ ì„œë²„ì˜ ë³€ê²½ì‚¬í•­ì„ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- Room messageë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ Stateë¥¼ ì „ì†¡í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.
- ì„œë²„ì—ì„œ messageë¥¼ ìˆ˜ì‹ ë°›ì•„ Stateë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.
- ğŸ¥ ì˜ìƒ ë³´ê¸° : https://youtu.be/k-Vi8XVXGCY

[ 3í¸ : ì›”ë“œ ë¡œì§ ì‘ì„±í•˜ê¸° 2 ] 
- í”Œë ˆì´ì–´ì˜ ìœ„ì¹˜ ë™ê¸°í™”ë¶€í„° í”Œë ˆì´ì–´ì˜ í‡´ì¥ê¹Œì§€ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ì˜ í˜„ì¬ ìœ„ì¹˜ë¥¼ ì¼ì • ì‹œê°„ ë§ˆë‹¤ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  ì„œë²„ì—ì„œ ìˆ˜ì‹  ë°›ì€ ë‹¤ë¥¸ í”Œë ˆì´ì–´ì˜ ìœ„ì¹˜ë¥¼ ë™ê¸°í™”í•©ë‹ˆë‹¤.
- ë§ˆì§€ë§‰ìœ¼ë¡œ í”Œë ˆì´ì–´ì˜ í‡´ì¥ì— ëŒ€í•œ ì²˜ë¦¬ë„ ì§„í–‰í•´ ì›”ë“œ ë¡œì§ì„ ë§ˆë¬´ë¦¬í•©ë‹ˆë‹¤.
- ğŸ¥ ì˜ìƒ ë³´ê¸° : https://youtu.be/_PL7gEKgm_Q

[ 4í¸ : ì„œë²„ êµ¬ë™ ë° ë©€í‹°í”Œë ˆì´ ì ‘ì†í•˜ê¸° ] 
- ì´ë²ˆ í¸ì—ì„œëŠ” ì„œë²„ë¥¼ êµ¬ë™í•˜ê³  ì ‘ì†í•˜ì—¬ ë©€í‹°í”Œë ˆì´ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
- ë¨¼ì € ì„œë²„ë¥¼ êµ¬ë™í•˜ê³  ì ‘ì†í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  QRì½”ë“œ ì ‘ì†ê³¼ IPì£¼ì†Œë¡œ ì ‘ì† í•  ìˆ˜ ìˆëŠ” custom environment ë°©ì‹ìœ¼ë¡œ
- ë©€í‹°í”Œë ˆì´ í™˜ê²½ì— ì ‘ì†í•´ë´…ë‹ˆë‹¤.
-  ğŸ¥ ì˜ìƒ ë³´ê¸° : https://youtu.be/FmK6JNlSjJA

[ 5í¸ : ë©€í‹°í”Œë ˆì´ ì‹¬í™”:IWP ì„œë²„ ì—°ë™ê³¼ ì„œë²„ DataStorage ]
- ë©€í‹°í”Œë ˆì´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ IWPì™€ DataStorageë¥¼ í™œìš©í•´ë´…ë‹ˆë‹¤.
- ì›”ë“œ ìƒí’ˆì„ êµ¬ë§¤í•  ìˆ˜ ìˆëŠ” IWP ê¸°ëŠ¥ì„ í†µí•´ ì›”ë“œì— ë¬¼ì•½ì„ ë§Œë“¤ê³ 
- êµ¬ë§¤ ì‹œ í”Œë ˆì´ì–´ ì´ë™ ì†ë„ê°€ ì¦ê°€í•˜ë„ë¡ êµ¬í˜„í•´ ë´…ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  í”Œë ˆì´ì–´ì˜ ë°ì´í„°ë¥¼ ì„œë²„ì— ì €ì¥í•´ì£¼ëŠ” DataStorageë¥¼ í†µí•´
- í”Œë ˆì´ì–´ì˜ ì´ë™ ì†ë„ë¥¼ ì €ì¥í•˜ê³  ì´í›„ ì…ì¥ ì‹œì— ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê³¼ì •ì„ ì§„í–‰í•´ë´…ë‹ˆë‹¤.
-  ğŸ¥ ì˜ìƒ ë³´ê¸° : https://youtu.be/d-MaqjP-vjA



<br/><br/>

## Room State ì •ì˜í•˜ê¸°
StateëŠ” ì ‘ì† ì¤‘ì¸ Roomì˜ í”Œë ˆì´ì–´ ì •ë³´, í”Œë ˆì´ì–´ ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ì˜ ìœ„ì¹˜ ë“±ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ data structure ì…ë‹ˆë‹¤. 
Multiplay íŒ¨í‚¤ì§€ë‚´ì— [schema íŒŒì¼](https://github.com/naverz/zepeto-multiplay-example/blob/main/Assets/World.multiplay/schemas.json)ì— ì •ì˜ë˜ì–´ ìˆìœ¼ë©°, ì„œë²„ êµ¬ë™ì‹œ ìƒì„±ë˜ë©° ë°ì´í„° ë³€ê²½(ìœ ì € ì ‘ì†/í‡´ì¥, ìœ„ì¹˜ ì´ë™ë“±)ì‹œ ê° í´ë¼ì´ì–¸íŠ¸ì— broadcast ë©ë‹ˆë‹¤. 

```typescript
declare module "ZEPETO.Multiplay.Schema" {
    interface State extends Schema {
        players: MapSchema<Player>;
    }
    class Player extends Schema {
        sessionId: string;
        zepetoHash: string;
        zepetoUserId: string;
        transform: Transform;
        state: number;
    }
    class Transform extends Schema {
        position: Vector3;
        rotation: Vector3;
    }
    class Vector3 extends Schema {
        x: number;
        y: number;
        z: number;
    }
}
```
Schema > Player classëŠ” Worldì— ì ‘ì†í•œ ìœ ì €ì˜ í˜„ì¬ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ë©°, ìœ ì €ì˜ ì¸ì¦ì •ë³´(sessionId, zepetoHash, zepetoUserId)ì™€ ìºë¦­í„° ìœ„ì¹˜ì •ë³´(transform), ê·¸ë¦¬ê³  ìºë¦­í„° ëª¨ì…˜ìƒíƒœ(state)ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

<br/><br/>

## ê²Œì„ ë¡œì§ ì‘ì„±í•˜ê¸°
#### Room ì…ì¥ ë° ìºë¦­í„° ì´ˆê¸°í™”
Room ìƒì„± / ì…ì¥ / ìºë¦­í„° ìƒì„± ì²˜ë¦¬ ì½”ë“œì…ë‹ˆë‹¤.

- [Server](https://github.com/naverz/zepeto-multiplay-example/blob/77128679e86dcee15816b060b9809033dc2a8bc0/Assets/World.multiplay/index.ts#L11)<br/>
Serverì— ì²˜ìŒ Playerê°€ ì ‘ì†í•  ë•Œ Roomê°ì²´ê°€ ìƒì„±ë˜ê³  onCreate ì´ë²¤íŠ¸ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.Â 

onJoin ì´ë²¤íŠ¸ëŠ” Roomì— ìƒˆë¡œìš´ Playerê°€ ì…ì¥í•  ë•Œ ë§ˆë‹¤ í˜¸ì¶œë©ë‹ˆë‹¤. í•´ë‹¹ ì´ë²¤íŠ¸ì— ìƒˆë¡œìš´ Playerì˜ StateObjectë¥¼ ìƒì„±í•´ Stateì— ì¶”ê°€ í•©ë‹ˆë‹¤.Â 

```typescript
onCreate(options: SandboxOptions) {

    this.onMessage("onChangedTransform", (client, message) => { ... });	
	this.onMessage("onChangedState", (client, message) => { ... });
}

async onJoin(client: SandboxPlayer) {

    // Roomì— ì…ì¥í•œ playerì˜ StateObjectë¥¼ ìƒì„±í•´ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    const player = new Player();
    player.sessionId = client.sessionId;

    //DataStoageë¥¼ í†µí•´, (ì´ì „ì— ì ‘ì†í–ˆë˜ playerì¼ ê²½ìš°) ë§ˆì§€ë§‰ ìœ„ì¹˜ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const storage: DataStorage = client.loadDataStorage();
    const raw_val = await storage.get("transform") as string;

    const transform = new Transform();
    ...
    player.transform = transform;

    // sessionIdë¥¼ keyë¡œ í•˜ì—¬, player stateë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
    this.state.players.set(client.sessionId, player);
}
```

- [Client](https://github.com/naverz/zepeto-multiplay-example/blob/77128679e86dcee15816b060b9809033dc2a8bc0/Assets/ZepetoScripts/ClientStarter.ts#L14) </br>
Playerê°€ Roomì— ì…ì¥í•˜ë©´ RoomCreatedì™€ RoomJoined ì´ë²¤íŠ¸ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
Roomì— ì…ì¥ì´ ì™„ë£Œë˜ë©´ ì„œë²„ ìƒíƒœ ë³€ê²½ì„ ìˆ˜ì‹ í•˜ê¸° ìœ„í•´ì„œ OnStateChage(State, isFirst:true)ì— ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. 

```typescript
Start()
{
    this.multiplay.RoomCreated += (room: Room) => {
        this.room = room;
    };

    this.multiplay.RoomJoined += (room: Room) => {
        room.OnStateChange += this.OnStateChange;
    };
}


OnStateChange(state: State, isFirst: boolean) {

    ...
 
    let join = new Map<string, Player>();
 
    state.players.ForEach((sessionId: string, player: Player) => {
       
        // Roomì— ìƒˆë¡œ ì…ì¥í•œ playerë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
        if (!this.currentPlayers.has(sessionId))
            join.set(sessionId, player);    
        ...
    });
 
    ...
    // [RoomState] Roomì— ì…ì¥í•œ player ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    join.forEach((player: Player, sessionId: string) => this.OnJoinPlayer(sessionId, player));
}
```

Roomì— ìƒˆë¡œìš´ í”Œë ˆì´ê°€ ì…ì¥í• ë•Œ ì—ë²¤íŠ¸ë¥¼ ìˆ˜ì‹  í•  ìˆ˜ ìˆë„ë¡ player ê°ì²´ì— OnJoinPlayer ì´ë²¤íŠ¸ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤. 
OnJoinPlayer í˜¸ì¶œì‹œ í•´ë‹¹ í”Œë ˆì´ì–´ìš© CharacterController instanceë¥¼ ìƒì„±í•˜ê³ , ìºë¦­í„° ë¡œë”© ì´ë²¤íŠ¸(OnAddedPlayer / OnAddedLocalPlayer)ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.

```typescript
OnJoinPlayer(sessionId: string, player: Player) {

    ...

    // 1) isLocal(boolean) Flagì— ë”°ë¼, Local Player ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„ íƒì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
    ZepetoPlayers.instance.CreatePlayerWithUserId(sessionId, player.zepetoUserId, spawnInfo, isLocal);
}


OnStateChange(state: State, isFirst: boolean) {

    if (isFirst) {
		...

        ZepetoPlayers.instance.OnAddedLocalPlayer.AddListener(() => {
            // 2) (Local)Player ì¸ìŠ¤í„´ìŠ¤ê°€ ì™„ì „íˆ Sceneì— ë¡œë“œë˜ì—ˆì„ ë•Œ, í˜¸ì¶œë©ë‹ˆë‹¤.
        });

        ZepetoPlayers.instance.OnAddedPlayer.AddListener((sessionId: string) => {
            // 2) (Local/Normal)Player ì¸ìŠ¤í„´ìŠ¤ê°€ ì™„ì „íˆ Sceneì— ë¡œë“œ ë˜ì—ˆì„ ë•Œ, í˜¸ì¶œë©ë‹ˆë‹¤. 
        });
    }
}
```

#### Player ìœ„ì¹˜ ë™ê¸°í™”í•˜ê¸°
Roomë‚´ì— Playerë“¤ì˜ ìœ„ì¹˜ì™€ ìƒíƒœë¥¼Â  Sync. í•˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤.Â 

- Server<br/>
ê°œë³„ í´ë¼ì´ì–¸íŠ¸ì˜ ìœ„ì¹˜ë¥¼ ìˆ˜ì‹  ë°›ì„ìˆ˜ ìˆë„ë¡ 'onChangedTransform' ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆë¥¼ ìƒì„±í•©ë‹ˆë‹¤. onChangedTransform ë©”ì‹œì§€ê°€ ìˆ˜ì‹ ë˜ë©´, ì„œë²„ì˜ player stateë¥¼ ë³€ê²½í•˜ë„ë¡ ë¡œì§ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ë•Œ ë³€ê²½ëœ ì„œë²„ ìƒíƒœëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ onStateChangeë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. 
```
onCreate(options: SandboxOptions) {

    // ìºë¦­í„° ìœ„ì¹˜ ê°±ì‹ (onChangedTransform) ì´ë²¤íŠ¸ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.  
    this.onMessage("onChangedTransform", (client, message) => {
        const player = this.state.players.get(client.sessionId); 
        const transform = new Transform();

        ...    
        player.transform = transform;
    });
}
```

- Client<br/>
1. [ë‚´ ìºë¦­í„° ìœ„ì¹˜ ì •ë³´ ì „ë‹¬í•˜ê¸°](https://github.com/naverz/zepeto-multiplay-example/blob/77128679e86dcee15816b060b9809033dc2a8bc0/Assets/ZepetoScripts/ClientStarter.ts#L108) </br>
ë‚´ ìºë¦­í„°(local player)ì˜ ìœ„ì¹˜ë¥¼ ì„œë²„ì— ì—…ë°ì´íŠ¸ í•˜ë ¤ë©´, RoomdData ê°ì²´ì— ìºë¦­í„° ìœ„ì¹˜ë¥¼ ì—…ë°ì´íŠ¸ í•œ í›„, onChangedTransformë¥¼ í‚¤ì›Œë“œë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. ìºë¦­í„°ì˜ ìƒíƒœë‚˜ ì¸ë²¤í† ë¦¬ ì„¤ì •ë“±ê³¼ ê°™ì€ ì •ë³´ë„ ììœ ë¡­ê²Œ ì •ì˜í•˜ì—¬ ì „ë‹¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
private SendTransform(transform: UnityEngine.Transform) {
        const data = new RoomData();
 
        const pos = new RoomData();
        pos.Add("x", transform.localPosition.x);
        pos.Add("y", transform.localPosition.y);
 
        pos.Add("z", transform.localPosition.z);
        data.Add("position", pos.GetObject());
 
        const rot = new RoomData();
        rot.Add("x", transform.localEulerAngles.x);
        rot.Add("y", transform.localEulerAngles.y);
        rot.Add("z", transform.localEulerAngles.z);
        data.Add("rotation", rot.GetObject());
        this.room.Send("onChangedTransform", data.GetObject());
    }
```

2. [ë‹¤ë¥¸ ìºë¦­í„° ìœ„ì¹˜ ìˆ˜ì‹  í•˜ê¸°](https://github.com/naverz/zepeto-multiplay-example/blob/77128679e86dcee15816b060b9809033dc2a8bc0/Assets/ZepetoScripts/ClientStarter.ts#L74)</br>
OnStateChange ì´ë²¤íŠ¸ í•¨ìˆ˜ëŠ” ì„œë²„ì—ì„œ State (ìºë¦­í„° ìƒíƒœ ë˜ëŠ” ìœ„ì¹˜)ê°€ ë³€ê²½ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤. ìˆ˜ì‹ ëœ ìºë¦­í„°ì˜ Stateë¥¼ ë¡œì»¬ì— ìƒì„±ëœ CharacterController instanceì— ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤. 

```typescript
 playerState.OnChange += (changedValues) => {
        const zepetoPlayer = ZepetoPlayers.instance.GetPlayer(sessionId);
        ...
        const position = this.ParseVector3(playerState.transform.position);
        zepetoPlayer.character.MoveToPosition(position);
 
        if (playerState.state === CharacterState.JumpIdle || playerState.state === CharacterState.JumpMove)
                zepetoPlayer.character.Jump();
        ...
  };
```
<br/>

#### Room í‡´ì¥
Roomì—ì„œ Playerê°€ í‡´ì¥í•  ë•Œ í•„ìš”í•œ ë¡œì§ì„ ì‚½ì…í•©ë‹ˆë‹¤.
- [Server](https://github.com/naverz/zepeto-multiplay-example/blob/774ec92ccc3cca7ceb6ccbf5d6ee6ac2c15363c4/Assets/World.multiplay/index.ts#L92) </br>
Playerê°€ Roomì„ ë– ë‚ ë•Œ onLeaveì´ë²¤íŠ¸ê°€ í˜¸ì¶œë©ë‹ˆë‹¤. ì´ë•Œ í•´ë‹¹ playerë¥¼ State>players ëª©ë¡ì—ì„œ ì œê±°í•©ë‹ˆë‹¤. 

```typescript
async onLeave(client: SandboxPlayer, consented ?: boolean) {
 
    // í‡´ì¥ Player Storage Load
    const storage: DataStorage = client.loadDataStorage();
    const player = this.state.players.get(client.sessionId);
    ...  
 
    const transform = {
        position: { x: position.x, y: _pos.y, z: _pos.z },
        ...
    };
 
    // í‡´ì¥í•˜ëŠ” ìœ ì €ì˜ transformì„ json í˜•íƒœë¡œ ì €ì¥í•œ ë‹¤ìŒ, ì¬ì ‘ì† ì‹œ load í•©ë‹ˆë‹¤.
    await storage.set("transform", JSON.stringify(transform));
 
    // sessionIdì— í•´ë‹¹í•˜ëŠ” playerë¥¼ stateì—ì„œ ì œê±°í•©ë‹ˆë‹¤.
    this.state.players.delete(client.sessionId);
}
```

- [Client](https://github.com/naverz/zepeto-multiplay-example/blob/774ec92ccc3cca7ceb6ccbf5d6ee6ac2c15363c4/Assets/ZepetoScripts/ClientStarter.ts#L85) </br>
Playerê°€ Roomì„ ë– ë‚˜ë©´ ì„œë²„ ë¡œì§ì—ì„œ player stateë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. ë³€ê²½ëœ stateì •ë³´ëŠ” í´ë¼ì´ì–¸íŠ¸ì— ë“±ë¡ëœ onStateChange ì´ë²¤íŠ¸ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤. 
ì´ë•Œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë‚´ì— ZepetoPlayers instanceì—ì„œë„ í‡´ì¥ëœ ìºë¦­í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤. 

```typescript
OnStateChange(state: State, isFirst: boolean) {
 
    ...
    let leave = new Map<string, Player>(this.currentPlayers);
 
    state.players.ForEach((sessionId: string, player: Player) => { 
         
        ...
        leave.delete(sessionId);
    });
 
    ...
    // [RoomState] Roomì—ì„œ í‡´ì¥í•œ player ì¸ìŠ¤í„´ìŠ¤ ì œê±°
    leave.forEach((player: Player, sessionId: string) => this.OnLeavePlayer(sessionId, player));
}
 
OnLeavePlayer(sessionId: string, player: Player) {
    this.currentPlayers.delete(sessionId);
    ZepetoPlayers.instance.RemovePlayer(sessionId);
}
```

<br/><br/>

## Additional Samples

[ScreenShotSample](https://github.com/naverz/zepeto-multiplay-example/blob/main/Assets/Resources/ScreenShot/doc/README.md)
